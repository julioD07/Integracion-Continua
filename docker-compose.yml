# Nota: se elimin√≥ la clave "version" para evitar la advertencia
services:
  # --- Base de datos SQL Server ---
  # mssql:
  #   image: mcr.microsoft.com/mssql/server:2019-latest
  #   container_name: mssql
  #   restart: always
  #   environment:
  #     SA_PASSWORD: "Unibol2025*"
  #     ACCEPT_EULA: "Y"
  #     MSSQL_PID: "Developer"
  #   ports:
  #     - "1433:1433"
  #   volumes:
  #     - mssql-data1:/var/opt/mssql

  mariadb:
    image: mariadb:11.1
    container_name: mariadb_music_portal
    restart: always
    environment:
      MYSQL_ROOT_PASSWORD: rootpassword
      MYSQL_DATABASE: music-portal-db
    ports:
      - "3308:3306"
    volumes:
      - mariadb_data:/var/lib/mysql

  phpmyadmin:
    image: phpmyadmin/phpmyadmin
    container_name: phpmyadmin_music_portal
    restart: always
    environment:
      PMA_HOST: mariadb
      PMA_USER: root
      PMA_PASSWORD: rootpassword
    ports:
      - "8080:80"
    depends_on:
      - mariadb


  # --- API NestJS ---
  nest-app:
    build: ./backend-music-portal
    container_name: nest-app
    depends_on:
      - mariadb
    ports:
      - "3000:3000"
    # volumes:
    #   - ./backend-music-portal:/app
    #   - /app/node_modules
    environment:
      - NODE_ENV=development
      - DATABASE_URL=mysql://root:rootpassword@mariadb:3306/music-portal-db
      - PORT=3000
      - SECRETKEY=Pudin
      - PATH_FILES=./
    # command: npm run start:dev
    # Volumen en la carpeta /app/uploads del contenedor nest-app
    volumes:
      - ./backend-music-portal/uploads:/app/uploads

  # --- Frontend Vite ---
  vite-app:
    build: ./music-portal
    container_name: vite-app
    
    depends_on:
      - nest-app
    ports:
      - "5173:5173"
    volumes:
      - ./music-portal:/app
      - /app/node_modules
    environment:
      - NODE_ENV=development
      - VITE_API_URL=http://nest-app:3000
    command: npm run dev -- --host

volumes:
  mariadb_data:

    
